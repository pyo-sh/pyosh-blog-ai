services:
  dev-lab:
    build: .
    container_name: dev-lab
    stdin_open: true
    tty: true
    network_mode: host
    volumes:
      - ../../:/workspace
      # 인증/설정 (독립 volume — 컨테이너 재생성해도 유지)
      - dev-auth:/home/dev/.auth
      # tmux, bash_aliases는 /workspace 심링크로 연결 (entrypoint.sh)
      # 단일 파일 bind mount는 에디터가 inode를 교체하면 깨지므로 사용하지 않음
    environment:
      - TZ=${TZ:-Asia/Seoul}
    env_file:
      - ../../.env
    working_dir: /workspace
    # tmuxinator로 세션 시작 — 호스트에서 docker exec -it dev-lab tmux attach -t lab 로 접속
    command: bash -c "/home/dev/.tmux/plugins/tpm/bin/install_plugins && TMUX_ROOT=/workspace tmuxinator start -p tools/tmux/session.docker.yml && tail -f /dev/null"

volumes:
  dev-auth:
    name: dev-lab-auth
