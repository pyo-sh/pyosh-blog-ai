# Task 10: 배포 인프라 강화

> 환경 변수 검증 + Health check 확장 + DB 마이그레이션 자동화

## 선행 조건

- [x] Fastify 서버 구동 완료
- [x] Drizzle 마이그레이션 체계 구축

## 작업 항목

### 1. 환경 변수 검증

- [ ] **Zod 기반 환경 변수 스키마 정의**
  - DB 연결 정보, 세션 시크릿, OAuth 키 등 필수 변수
  - 타입 변환 (포트 번호 string → number 등)
- [ ] **서버 시작 시 검증 실행**
  - 누락/잘못된 환경 변수 시 명확한 에러 메시지와 함께 즉시 종료
- [ ] **`.env.example` 업데이트**

### 2. Health Check 확장

- [ ] **`GET /api/health` 응답 확장**
  - DB 연결 상태 확인 (SELECT 1)
  - 서버 가동 시간 (uptime)
  - 메모리 사용량
  - 버전 정보
- [ ] **Readiness / Liveness 분리 (선택)**
  - `/api/health/live`: 서버 응답 가능 여부
  - `/api/health/ready`: DB 등 의존성 포함

### 3. DB 마이그레이션 자동화

- [ ] **CI/CD 파이프라인에 마이그레이션 단계 추가**
  - 배포 전 `drizzle-kit migrate` 자동 실행
- [ ] **마이그레이션 롤백 전략 검토**
  - Drizzle 롤백 지원 여부 확인
- [ ] **마이그레이션 상태 확인 스크립트**
  - 적용된/미적용 마이그레이션 목록 출력

## 검증

- [ ] 필수 환경 변수 누락 시 서버 시작 실패 확인
- [ ] Health check 응답에 DB 상태 포함 확인
- [ ] 마이그레이션 자동 실행 확인
- [ ] 기존 서버 동작 영향 없음
